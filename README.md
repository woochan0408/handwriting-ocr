# Handwrite-OCR: 손글씨 노트 디지털화 프로젝트

> 손글씨의 장점은 유지하면서, 디지털의 편의성을 더하다

## 목차
- [배경](#배경)
- [문제 정의](#문제-정의)
- [해결 전략](#해결-전략)
- [핵심 성과](#핵심-성과)
- [기술 스택](#기술-스택)
- [실행 방법](#실행-방법)
- [한계 및 개선 방향](#한계-및-개선-방향)

---

## 배경

### 문제 상황

공부할 때 타이핑 필기와 손글씨 필기를 병행하고 있습니다. 손글씨 필기는 그림, 다이어그램, 수식을 자유롭게 표현할 수 있고 기억에도 오래 남는다는 장점이 있습니다. 

하지만 복습 시점에 문제가 발생합니다:
- **검색 불가**: 어떤 내용이 어디 있는지 기억에만 의존
- **물리적 제약**: 노트를 일일이 찾아봐야 함
- **관리의 파편화**: 타이핑 필기와 분리되어 전체 학습 내용을 한눈에 보기 어려움
- **AI 활용 불가**: 텍스트 형태가 아니어서 AI 기반 학습 도구 사용 불가능

특히 AI 시대에 손글씨 노트는 단순히 검색이 안 되는 것을 넘어, **AI의 도움을 전혀 받을 수 없다는** 치명적인 한계가 있습니다.

### 목표

손글씨의 장점(높은 자유도, 기억 효과)은 유지하면서 디지털의 편의성을 더하고자 합니다:

**즉시 활용 가능:**
- 검색으로 원하는 내용 빠르게 찾기
- 언제 어디서나 복습 가능
- 타이핑 필기와 통합 관리

**AI 활용 가능:**
- AI 기반 요약 및 핵심 개념 추출
- 자동 플래시카드 생성
- 학습 내용 기반 질문 생성
- 주제별 연결 관계 파악

이를 위해 **손글씨 노트 이미지를 구조화된 텍스트로 변환하는 시스템**을 구축했습니다.

---

## 문제 정의

손글씨를 디지털화하려면 OCR이 필요한데, 기존 접근법에는 각각 치명적인 한계가 있었습니다.

### 기존 접근법의 딜레마

| | 전통적인 OCR | LLM 기반 OCR |
|-----------------|-------------|-------------|
| **정확도** | 원본에 충실 |  할루시네이션 위험 |
| **텍스트 정제** | 오탈자 많음, 문맥 무시 | 구조화, 문맥 반영 |
| **표/그래프 이해** | 텍스트만 추출 | 이미지 캡셔닝 가능 |

### LLM기반 이미지캡셔닝의 할루시네이션
![KakaoTalk_Photo_2025-11-24-12-10-46](https://github.com/user-attachments/assets/9a7964e6-54c2-45bc-87a5-05d07e8d77c8)

**핵심 질문:**
> 어떻게 할루시네이션 없이 정제된 텍스트를 얻을 수 있을까?

---

## 해결 전략
![KakaoTalk_Photo_2025-11-24-12-01-03 001](https://github.com/user-attachments/assets/818efdf4-382b-4052-9684-f2cc22dde729)
![KakaoTalk_Photo_2025-11-24-12-01-04 002](https://github.com/user-attachments/assets/7609c8a3-f6e5-42ea-b919-8b18b843ab6a)

### OCR First, LLM Second 하이브리드 파이프라인

두 접근법의 장점만 결합하는 전략:

1. **Stage 1-3: 정확한 원본 확보**
   Google Vision OCR로 실제 손글씨 텍스트 추출 (원본 충실도 확보)

2. **Stage 4: 안전한 정제**
   GPT-4로 후처리하되, **OCR 결과만을 기반으로 수정**하도록 제한
   → 할루시네이션 방지 + 구조화 달성

### 레이아웃 분석이 필요한 이유



손글씨 노트는 종종 2분할(좌/우) 또는 4분할 레이아웃을 사용합니다.

**문제점:**
전체 이미지를 한 번에 OCR하면 읽기 순서가 꼬임 (좌→우→좌→우 vs 좌 전체→우 전체)

**해결책:**
1. 레이아웃 자동 분석 (OpenCV Hough Line Transform)
2. 영역별로 이미지 분리
3. 각 영역을 독립적으로 OCR → 정제
4. 문맥이 유지되고 읽기 순서가 명확한 결과 산출

---

## 핵심 성과

1. **GPT-4o-mini 선택으로 장당 처리 비용 $0.00218 달성** - 업계 최저 수준
4. **할루시네이션 8%로 제어** - 실용적 수준의 정확도

---

## 기술 스택

### 선택 기준과 근거

| 기술 | 사용 이유 |
|------|----------|
| **DocAligner** | 노트 경계 검출에 특화된 딥러닝 모델 |
| **OpenCV** | 이미지 처리 및 Hough Line Transform 구현 |
| **Google Cloud Vision** | 손글씨 OCR에서 검증된 상용 API (document_text_detection) |
| **OpenAI GPT-4o-mini** | 저가 모델 활용 + 구조화 능력 우수 |

---

## 실행 방법

### 1. 사전 준비

**필수 요구사항:**
- Python 3.10 이상 (3.11.9 권장)
- Google Cloud Vision API 인증 정보
- OpenAI API 키

### 2. 설치

```bash
# 가상환경 생성 및 활성화
python -m venv venv
source venv/bin/activate  # Mac/Linux
# venv\Scripts\activate   # Windows

# 패키지 설치
pip install -r requirements.txt
```

### 3. 환경 설정

`.env` 파일 생성:
```bash
GOOGLE_APPLICATION_CREDENTIALS=path/to/your/google-credentials.json
OPENAI_API_KEY=your-openai-api-key
IMAGE_DIRECTORY=./test_images
IMAGE_FILENAME=your_image.jpg
```

### 4. 실행

**전체 파이프라인 실행:**
```bash
python run_analysis.py
```

---

## 한계 및 개선 방향

### 현재 한계

**1. 정제 vs 할루시네이션 Trade-off**
- Temperature, 프롬프트로 완화했지만 완전 해결은 어려움
- 정제 강도를 높이면 할루시네이션 위험 증가

**2. 레이아웃 제약**
- 현재 지원: 0/2/4 영역만
- 미지원: 가로 분할, 곡선 분할, 불규칙 레이아웃

**3. OCR 품질 의존성**
- 손글씨 가독성에 따라 정확도 편차 큼
- 휘갈겨 쓴 글씨는 인식률 저하

**4. 비용**
- Google Vision API: 이미지당 과금
- OpenAI GPT-4: 토큰당 과금
- 대량 처리 시 비용 고려 필요

### 향후 개선 방향

**단기 (기능 개선):**
- [ ] 사용자가 정제 강도를 조절할 수 있는 옵션 추가
- [ ] OCR 신뢰도 기반 선택적 정제 (확신도 낮은 부분만 LLM 처리)
- [ ] 다양한 레이아웃 패턴 지원 (가로 분할, 8분할 등)
- [ ] 배치 처리 기능 (여러 이미지 한 번에 처리)

**중기 (품질 개선):**
- [ ] 다중 모델 앙상블 (여러 LLM 결과 비교 후 최적 선택)
- [ ] 사용자 피드백 루프 (수정 내역 학습)
- [ ] 표/그래프 영역 자동 감지 및 별도 처리

**장기 (통합 관리):**
- [ ] 웹 UI 개발 (드래그 앤 드롭 업로드, 실시간 미리보기)
- [ ] 검색 가능한 노트 데이터베이스 구축
- [ ] 타이핑 필기와 통합 관리 플랫폼

---

## 라이선스 및 주의사항

**사용 API:**
- Google Cloud Vision API (유료)
- OpenAI API (유료)
